## LaunchPad – 高仿 macOS Launchpad 的桌面启动器

一个使用 **SwiftUI + AppKit** 实现的 **高仿系统 Launchpad** 应用，目标是在视觉、交互和体验上尽可能贴近原生 macOS Launchpad，同时保持代码结构清晰、可长期演进。

---

## 项目目标（Goals）

- **高还原度外观**：整体布局、背景虚化/毛玻璃、分页指示器、图标网格、文件夹弹出视图等尽量贴近系统 Launchpad。
- **接近系统的交互体验**：
  - 全屏覆盖、隐藏菜单栏和 Dock（伪全屏，不创建新 Space）。
  - 支持键盘 Esc / 空格 / 方向键 / 回车 等典型操作。
  - 图标点击启动 App、长按抖动、拖拽排序、拖拽进文件夹。
- **平滑的过渡动画**：进入 / 退出 Launchpad 的整体淡入淡出、图标缩放、分页滑动、文件夹弹出等。
- **良好的可维护性和扩展性**：代码模块清晰、状态管理简单可控，方便后期添加搜索、分组、自定义布局等高级功能。

---

## 运行环境与快速开始

- **最低系统要求**：macOS 13+（推荐最新稳定版本）。
- **开发工具**：Xcode 15+。
- **语言版本**：Swift 5.9+。

### 本地运行

- **1. 克隆项目**
  - `git clone <repo-url>`
  - `cd LaunchPad`
- **2. 使用 Xcode 打开**
  - 打开 `LaunchPad.xcodeproj`。
  - 选择 `LaunchPadApp` 作为运行目标（若存在多个 target，以文档/工程实际为准）。
- **3. 运行**
  - 选择 `My Mac` 作为运行设备，直接 `⌘R` 运行。

---

## 当前进度概览

- **阶段 0：基础工程 & 伪全屏 Launchpad 容器**：进行中（0.2 已实现基本 fake fullscreen + 动画）。
- **阶段 1：基础 UI – 单页图标网格**：进行中（已有真实 App 数据 + 第一版分页网格 + 可配置的网格布局）。
- **阶段 2：分页和页面指示器**：进行中（基础分页 + 指示器雏形 + 滚轮翻页 + 指示器固定在底部）。
- **阶段 3：搜索与过滤**：规划中。
- **阶段 4：编辑模式（图标抖动、删除按钮）**：规划中。
- **阶段 5：拖拽排序与文件夹**：规划中。
- **阶段 6：视觉优化与性能调优**：规划中。

**短期优先方向（Next steps，待选择）**：
- A：继续打磨“单页网格”的视觉细节，使之更接近系统 Launchpad。
- B：基于现有 `LaunchpadLayout` 补上分页与底部页面指示器。
- C：加入顶部搜索栏与基础过滤能力。

---

## 技术选型与架构概览

- **UI 框架**：SwiftUI
  - 负责所有界面布局、动画和状态管理（图标网格、分页、搜索栏、文件夹视图等）。
- **窗口层 & 系统集成**：AppKit（`NSWindow` / `NSApplicationDelegate`）
  - 使用“伪全屏”方式模拟系统 Launchpad：
    - 隐藏菜单栏 & Dock（`NSApp.presentationOptions`）。
    - 使用无边框、全内容视图的窗口，覆盖整个屏幕。
    - 不使用系统全屏，不创建新的 Space，增强灵活性。
  - 键盘事件监听（退出 Launchpad / 恢复菜单栏和 Dock）。
  - 窗口生命周期回调（窗口创建完成后再配置全屏和动画）。
- **状态管理**：在 SwiftUI 中使用 `@State` / `@StateObject` / `@EnvironmentObject`
  - 管理当前页、图标数据、搜索关键字、是否在“编辑模式”（图标抖动）等。
  - 通过独立的 `LaunchpadGridSettings` 管理“每行列数、每页行数”等可配置参数（后续扩展为网格边距、图标大小等）。

---

## 关键文件与目录（规划 & 当前实现）

- **`LaunchPadApp.swift`**：SwiftUI 入口，负责创建主场景。
- **`AppDelegate.swift`**：与 AppKit 桥接，负责：
  - 管理 `NSWindow` 生命周期、伪全屏配置。
  - 处理键盘事件（Esc / Space 等）。
  - 处理应用重新激活、Dock 图标点击等系统级回调。
- **`ContentView.swift` / `LaunchpadView.swift`**：
  - SwiftUI 主界面：`ContentView` 提供背景与退出手势，`LaunchpadView` 负责图标网格展示（当前实现了单页网格雏形）。
- **`Models.swift`**：
  - `AppItem`、`FolderItem`、`LaunchpadLayout` 等核心数据模型。
- **`DataSources.swift`**：
  - 数据源协议 `AppCatalogDataSource` / `LaunchpadLayoutDataSource`。
  - 方案一实现：`FileSystemAppCatalogDataSource`（扫描应用）、`LocalJSONLayoutDataSource`（本地 JSON 布局）。
- **`LaunchpadRepository.swift`**：
  - 上层使用的统一入口，组合 app 列表与布局数据源。
- **`LaunchpadViewModel.swift`**：
  - SwiftUI 使用的视图模型，桥接 `LaunchpadRepository` 与 `LaunchpadView`。

---

## 开发阶段与任务拆分

### 阶段 0：基础工程 & 伪全屏 Launchpad 容器

- **0.1 创建基础工程**
  - 使用 Xcode 创建 macOS App（SwiftUI 生命周期）。
  - 配置 Bundle ID、最低系统版本等。
- **0.2 构建 Launchpad 容器窗口（当前已在进行/部分完成）**
  - 在 `AppDelegate` 中接管 `NSApplicationDelegate` 生命周期。
  - 使用窗口生命周期回调（例如 `NSWindow.didBecomeMainNotification`）替代固定延迟，确保窗口创建完成后再配置。
  - 将主窗口配置为：
    - 无边框、隐藏标题栏（`borderless + fullSizeContentView`）。
    - 透明背景，由 SwiftUI 内容决定视觉效果。
    - 覆盖主屏幕全部区域（包括菜单栏区域）。
  - 通过 `presentationOptions` 隐藏菜单栏和 Dock。
  - 实现进入/退出 Launchpad 的淡入淡出动画（对整个 `window.alphaValue` 做动画）。

### 阶段 1：基础 UI – 单页图标网格

- **1.1 图标数据模型（进行中）**
  - 定义 `AppItem` 模型（名称、图标、Bundle Identifier、是否系统 App 等）并已实现。
  - 后续可扩展分类、标签等字段。
- **1.2 单页图标网格布局（进行中）**
  - 使用 SwiftUI 的 `LazyVGrid` 实现类似 Launchpad 的图标排列（当前已有基础网格雏形）。
  - 处理图标尺寸、行列间距、行数/列数配置。
  - 支持简单的 hover/点击高亮效果（规划中）。
  - 支持可配置的图标大小、网格边距（已实现，通过 `LaunchpadGridSettings` 持久化）。
  - **网格布局优化**：
    - 上下边距可调（范围：80-160，默认：120），同时控制顶部和底部间距，间距越大网格高度越小。
    - 动态行间距：根据可用高度和每页行数自动计算行间距，确保网格充分利用空间。
    - 内容不足一页时，网格从顶部显示，而非居中。
- **1.3 进入/退出 Launchpad 的基础动画**
  - 进入时整体淡入（已在 AppKit 层做窗口淡入，可以同步增加 SwiftUI 内容的小缩放/透明度过渡）。
  - 退出时整体淡出。

### 阶段 2：分页和页面指示器

- **2.1 多页数据组织**
  - 根据网格配置（行数/列数）计算每页可容纳的 `AppItem` 数量，并分页（Page 1、Page 2…）。
  - 状态中维护当前页索引。
- **2.2 分页切换交互（进行中）**
  - 支持按钮 / 键盘左右方向键切换页（当前已有按钮雏形）。
  - 支持鼠标滚轮 / 触控板上下滑动切换页（已通过全局 scroll 事件监听实现）。
- **2.3 页面指示器 UI（进行中）**
  - 底部小圆点指示当前页（当前已有基础实现）。
  - 指示器固定在屏幕底部，距离底部固定间距（32pt），高度固定（24pt），不随网格高度变化（已实现）。
  - 指示器与网格视图同一层级，上下边距设置影响网格与顶部屏幕以及网格与指示器之间的间距。
  - 小圆点平滑过渡动画（缩放/透明度）。

### 阶段 3：搜索与过滤

- **3.1 搜索栏 UI**
  - 顶部搜索输入框，样式尽量贴近系统 Launchpad。
  - 支持键盘快捷键唤起搜索（例如直接开始输入或快捷键）。
- **3.2 搜索逻辑**
  - 实时过滤 `AppItem` 列表，支持名称/拼音/别名等扩展（可先实现名称包含匹配）。
  - 匹配结果下只显示一个“搜索结果页”，隐藏分页指示器。
- **3.3 搜索时的动画细节**
  - 输入/清空搜索时，图标和页面指示器的出现/消失动画。

### 阶段 4：编辑模式（图标抖动、删除按钮）

- **4.1 进入/退出编辑模式**
  - 长按图标进入“抖动模式”，类似 iOS 主屏。
  - 在状态中维护 `isEditing`。
- **4.2 图标抖动动画**
  - 使用 SwiftUI 自定义动画/组合动画创建类似系统的轻微旋转 + 位移动画。
- **4.3 删除 & 隐藏**
  - 在编辑模式下显示图标左上角的 “X” 按钮。
  - 点击“X”后从列表中移除或标记隐藏（视为逻辑删除，方便撤销与偏好设置）。

### 阶段 5：拖拽排序与文件夹

- **5.1 图标拖拽排序**
  - 支持在同一页内拖拽重排图标位置。
  - 拖拽越界到页面边缘时，自动切换到上一页/下一页。
- **5.2 文件夹支持**
  - 将一个图标拖到另一个图标上方，创建文件夹。
  - 文件夹图标显示内部应用预览。
  - 点击文件夹图标，弹出中间的文件夹视图（带毛玻璃背景）。
- **5.3 文件夹内拖拽**
  - 在文件夹内部排序。
  - 从文件夹内拖出图标到外层页。

### 阶段 6：视觉优化与性能调优

- **6.1 视觉细节**
  - 背景模糊/毛玻璃效果（使用 `NSVisualEffectView` 或 SwiftUI 的 `VisualEffect` 封装）。
  - 阴影、选中高亮、hover 效果微调。
- **6.2 动画优化**
  - 所有过渡动画使用统一的 timing function（如 `.easeInEaseOut`），保持风格一致。
  - 避免复杂动画导致的掉帧，保证 60fps。
- **6.3 性能 & 内存**
  - 优化大规模 App 列表渲染（Lazy 容器、避免不必要的重绘）。
  - 检查渲染层级和透明视图数量，减少性能损耗。

---

## 设置面板设计（预览版）

- **入口**：
  - 在 Launchpad 空白区域右键（`contextMenu`）选择“打开 Launchpad 设置…”，弹出一个设置窗口（当前实现为 SwiftUI `sheet`）。
- **当前支持的设置项（实时生效）**：
  - 每行图标数（列数）：通过 `Stepper` 控制 `columnsPerRow`（范围：4-10）。
  - 每页行数：通过 `Stepper` 控制 `rowsPerPage`（范围：2-6）。
  - 左右边距：通过 `Slider` 控制 `horizontalMargin`（范围：40-400）。
  - 上下边距：通过 `Slider` 控制 `verticalMargin`（范围：80-160，默认：120）。
    - 上下边距同时控制网格与顶部屏幕以及网格与底部指示器之间的间距。
    - 间距越大，网格可用高度越小，行间距会自动调整以适应可用空间。
- **状态与持久化**：
  - 所有布局相关配置集中在 `LaunchpadGridSettings` 中（`ObservableObject` + `UserDefaults` 持久化）。
  - 设置修改后立即刷新 Launchpad 网格，不需要重启应用。
  - 未来可在此面板继续扩展图标大小、分页动画、指示器样式等高级选项。

---

## 技术决策备忘

- **为何使用“伪全屏”而非系统原生全屏**
  - 不创建新的 Space，避免频繁切换桌面带来的割裂感，更贴近系统 Launchpad 行为。
  - 对窗口行为有更细粒度的控制（层级、透明度动画、多次强制设置 frame 等）。
  - 更容易与 SwiftUI 内容协调，避免系统全屏模式下的一些限制。
- **为何保留 AppKit 层**
  - SwiftUI 目前对 `NSWindow` 生命周期、窗口级别动画、键盘监听等能力不如 AppKit 直接、稳定。
  - 使用 AppKit 负责“外壳”（窗口、系统交互），SwiftUI 负责“内容”（界面与状态），职责清晰。

---

## 键盘与系统交互规划

- **键盘行为（AppKit 层）**
  - Esc：退出 Launchpad（窗口淡出，恢复菜单栏和 Dock，隐藏窗口）。
  - Space：仅恢复菜单栏/Dock，但保留当前窗口（便于调试和后续扩展）。
  - 方向键 + 回车：后续用于键盘导航和启动应用。
- **应用生命周期**
  - 拦截 Dock 图标点击 / 应用重新激活事件，确保不会“再弹出一个小窗口”，而是回到现有 Launchpad 全屏窗口。
  - 使用 `applicationShouldHandleReopen` 等回调管理窗口显示逻辑。

---

## 后续扩展方向（Roadmap）

- 自定义分组 / 智能分组（按应用类型、使用频率等）。
- 记录并展示应用使用频次（常用应用区域）。
- 多显示器支持（主屏/副屏 Launchpad 覆盖策略）。
- 多语言 / 本地化支持。

---

## 开发约定

- **代码风格**
  - Swift 采用一致的命名风格（`camelCase`、清晰的类型命名）。
  - UI 组件拆分成可复用的 SwiftUI View，避免单文件过大。
- **模块划分建议**
  - `AppDelegate` / 窗口 & 系统集成（AppKit）。
  - `LaunchpadView` / `LaunchpadViewModel` 等（SwiftUI UI 层和状态）。
  - `Models`：应用数据、文件夹数据等。
  - `Services`：未来用于读取系统应用列表、持久化用户布局等。


